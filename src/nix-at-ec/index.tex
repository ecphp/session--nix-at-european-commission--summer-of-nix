\input{preamble}

\begin{document}

\begin{frame}[plain]
  \titlepage

  \note<1>{
    Hi my name is Pol Dellaiera and I started working for European
    Commission 10 years ago, as an external consultant.
  }
  \note<2>{
    Today I'm going to talk about the state of Nix at European Commission.
  }
  \note<3>{
    Before deep diving into the main subject, I'm going to talk about the
    relation that European Commission has with open source.
  }
\end{frame}

\section{Open source and European Commission}
\subsection{History}

\begin{frame}
  \frametitle{\subsecname}
  \framesubtitle{\secname}

  \begin{center}
    \only<1>{\transparent{0.2}}
    \only<2>{\transparent{0.4}}
    \only<3>{\transparent{0.6}}
    \only<4>{\transparent{0.8}}
    \begin{tikzpicture}[remember picture, overlay]
      \node[inner sep=0] (image) at (current page.center) {\includegraphics[width=\textwidth,keepaspectratio]{opensource-in-ec}};
      \only<9>{
        \fill [white, opacity=0.9]
          (image.south east) rectangle (image.north west)
          (2.9,-3) rectangle (6.3,-1.75);
      }
    \end{tikzpicture}
  \end{center}

  \note<1>{
    One of the take-aways of this talk would be that the Commission really
    recognises the practical value of open source.
  }
  \note<2>{
    Making a talk about Nix already demonstrate how we like this freedom
    to innovate, and how we like sharing these innovations with colleagues
    and with others, such as you The NixOS community.
  }
  \note<3>{
    But did you know that this is not something new???
  }
  \note<4>{
    Open source and the Commission goes back more than twenty years ago.
  }
  \note<5>{
    And over these 20 years, the Commission has grown to appreciate open
    source. To experiment new tools and innovate just like with Nix,
    but also because:
    \begin{itemize}
      \item lower costs,
      \item flexibility,
      \item scalability,
      \item vendor-independence
      \item and the list goes on\dots
    \end{itemize}
  }
  \note<6>{
    At EC, Digit is the central IT service for the whole Commission, it could be
    compared to the ministry of IT. This is also where I work\dots and I can
    tell you that we use open source every where.

    \begin{itemize}
      \item 75\% of our servers runs on Linux,
      \item The PHP language is used for mostly all Commission websites,
      \item NodeJS is used by eUI, a frontend web framework used by all
            internal EC web applications,
      \item Software developers uses more and more open source tools.
    \end{itemize}
  }
  \note<7>{
    \begin{itemize}
      \item In 2000, a colleague from JRC created the first building blocks of
            what eventually became Apache, one of the most popular web server.
      \item In 2007, the EUPL license has been created,
      \item And in 2011, the ESTAT project has for the first time open sourced
        some of its projects, this has been a threshold in the organisation.
      \item Since 2019, the ECPHP team - the team I work in - has released a
        dozen of open source projects and materials used within European
        Commission but also in other organisations. We are not the only team
        doing that, there are other teams doing the same!
    \end{itemize}
  }
  \note<8>{
    Over the past two decades, the use of software expanded, from the
    datacenter to Commission desktops - including web browser Firefox,
    media player VLC, LibreOffice, git\dots and so on.
  }
  \note<9>{
    And today, if we had to situate on this graph where we stand, it would
    be here, in the middle of "Contribute and Transform".
  }
  \note<10>{
    That is the reason why you see here in this diagram that there is a
    progression\ldots{}

    \begin{itemize}
      \item from an organisation that consumes open source,
      \item to one that produces its own solutions on top of open source
      \item to one that now wants to become involved in upstream projects
    \end{itemize}
  }
\end{frame}

\subsection{The strategy for the future}

\begin{frame}
  \frametitle{\subsecname}
  \framesubtitle{\secname}

  \begin{columns}[T] % align columns
    \begin{column}{.45\textwidth}
      \begin{center}
        \includegraphics[width=\textwidth,keepaspectratio]{Infographic_3_oss_strategy-05}
      \end{center}

    \end{column}%
    \hfill%
    \begin{column}{.45\textwidth}

      \begin{itemize}[<+->]
        \item Open source strategy
        \item The strategy impacts the entire organisation
        \item First public milestone in September 2022
        \item The idea: OSS to be the norm
      \end{itemize}

    \end{column}%
  \end{columns}

  \note<1>{
    That is reflected in the open source strategy officially published in
    2020.
  }
  \note<2>{
    The strategy led to the creation of a dedicated horizontal team - the
    Commission Open Source Programme Office.
  }
  \note<3>{
    On the 16th September in Brno (Czech Republic) we officially unveiled
    code.europa.eu, a public gitlab instance where we aim to share our
    software publicly.
  }
  \note<4>{
    I guess you got the point, we want open source to be everywhere at EC,
    and not only at Digit.
  }
  \note<5>{
    A good example is the cloud framework project 'Simpl', where open source is
    a strict requirement.
  }
  \note<6>{
    But let's check how European Commission is sponsoring Nix projects...
  }
\end{frame}

\subsection{Sponsorship}

\begin{frame}
  \frametitle{\subsecname}
  \framesubtitle{\secname}

  \begin{center}
    \begin{tikzpicture}[remember picture, overlay]
      \node[inner sep=0] (image) at (current page.center) {\includegraphics[width=.8\textwidth,keepaspectratio]{sponsoring}};
      \only<1>{
        \fill [white, opacity=0.9]
          (image.south east) rectangle (image.north west)
          (-5.1,-3) rectangle (-2.29,1);
      }
      \only<2>{
        \fill [white, opacity=0.95]
          (image.south east) rectangle (image.north west)
          (-5.1,-3) rectangle (0.30,1);
      }
    \end{tikzpicture}
  \end{center}

  \note<1>{
    European Commission has multiple DGs and \textpm800 open source projects are funded
    through DG CNECT and NGI.

    Examples like wireguard, TODO add more examples here.
  }
  \note<2>{
    Then, European Commission has partnerships with NLnet and the NixOS
    Foundation.
  }
  \note<3>{
    It is through those partners / intermediaries that 8 projects related to Nix
    are funded.

    If you would like to get your project funded also, there are open calls and
    submissions are now open till November!
  }
  \note<4>{
    Those projects are:
    \begin{itemize}
      \item Tvix
      \item DreamNix
      \item Mobile-NixOS
      \item Software vulnerability discovery
      \item Securing NixOS services with systemd
      \item UEFI support boot for NixOS
      \item RobotNix
      \item Trustix
    \end{itemize}
  }
  \note<5>{
    Let's now see how Nix is used concretely at European Commission by
    explaining the context and the reasons why it is used.

    Let's start with an overview of the environments we have\dots
  }
\end{frame}

\section{Nix and European Commission}
\subsection{Overview}

\begin{frame}
  \frametitle{\subsecname}
  \framesubtitle{\secname}

  \begin{center}
    \includegraphics[width=\textwidth,keepaspectratio]{computers}
  \end{center}

  \note<1>{
    In order to reduce the amount of bugs and unforeseen circumstances, we want
    to unify the developer environments.

    The will of the management is also to reduce the environment diversity and
    to ensure that developers uses a development environment which closely match
    what's in production.

    This is quite a challenge since there are a few different operating systems
    in the game as you can see in this graphic.
  }
  \note<2>{
    Some developers uses Microsoft Windows, some Linux on Amazon Workspaces
    using the yum package manager, some are using Linux on their Commission
    laptops which is running on an apt based distro, and some are using
    their own laptops running an arbitrary operating system, Windows, Linux
    or even Mac OS.
  }
  \note<3>{
    In addition to that, some people uses Docker and some others Ansible\dots

    And these tools, while very handy for some specific tasks, are not helping
    at all when it comes to reproducibility and unifying the developers
    development environment.

    Using the proper technology at the proper place is a golden rule.
  }
  \note<4>{
    And while some colleagues were busy exploring new tools to fix all
    aforementioned the issues, I was experimenting with Nix at home.

    So 18 months ago, I got rid of the Linux I was using and started by
    installing NixOS on my own Laptop, then on my backup laptop, then on my
    basement server and finally on my Raspberry running PiHole.

    And you know, since a all these years working with open source, I have in my
    mind the list of open source projects I like the most. First one being
    Blender the 3d suite, this is thanks to that software I ended up using Linux
    so many years ago. Second one is git for its awesomeness and the third
    one is now Nix without discussion.

    I love this project and its community so much that I've been angry with
    myself to not have discover it earlier. How it is possible ?! What was I
    doing all these years?

    Anyway, here's how I introduced Nix to my colleagues\dots
  }
  \note<5>{
    In the development competency center at Digit, the team I work in, I help
    teams and developers of all horizons to be successful in their development,
    promoting the use of best practices, doing live code review,
    proof-of-concept, and abstracting common parts in open source projects.

    One day, a team having issues aligning their development environments.
    They were all using the same Linux flavor, but some of them were not up to
    date, some of them did a major upgrade, some of them were using the bleeding
    edge packages, some others were not able to upgrade for some obscure reasons
    and finally some of them had multiple versions of the PHP interpreter and
    were unable to compile the required extensions to run their project.

    I guess you see the big picture. It would have been extremely time consuming
    to align everyone\dots and time is money.
  }
  \note<6>{
    And this is how it started, instead of loosing time understanding the
    reasons of all the mess, I decided to use Nix with them for the first time
    \dots and do you know what? They are extremely happy ever since, more
    productive than ever.

    Before going into the details of what I did, let's take a break an list what
    are the requirements of an average developer. This is the same kind of
    question that I asked myself as well.
  }
\end{frame}

\subsection{What does a developer want?}

\begin{frame}
  \frametitle{\subsecname}
  \framesubtitle{\secname}

  \begin{itemize}[<+->]
    \item To have a working development environment, working at anytime of
          the day
    \item Spawning instances of their project quickly
    \item Being aligned with their co-workers
    \item Avoid breaking their laptops
    \item Freedom to use the tool they prefer to do the job
  \end{itemize}

  \note<1>{
    Developers usually wants at anytime of the day, a working development
    environment
  }
  \note<2>{
    Developers usually wants to be able to spawn their projects quickly, as
    many times as they want. They want to quickly focus on what they are good
    at, without adding too much overhead.
  }
  \note<3>{
    Developers usually wants to have the same softwares as their colleagues,
    with the same version. It's easier to reproduce an issue in case of
    bugs.
  }
  \note<4>{
    Developers usually wants to avoid breaking their laptop when they have
    to install different or multiple versions of a particular software.
  }
  \note<5>{
    An happy and productive developer is a developer who uses its own tool.
    I guess there's no need to explain further, we all know what it means.

    A real life example would be me. Using the EC Linux laptop felt like a
    burden because I couldn't reproduce quickly and easily my usual development
    environment\dots

    Spoiler alert, I now use exclusively that laptop since I discovered Nix!
  }
  \note<6>{
    Given this, I ran a series of experiments with my colleagues, iterating over
    and over again until we reached some sort of stability and ease of use with
    Nix.
  }
\end{frame}

\subsection{What are we experimenting?}

\begin{frame}
  \frametitle{\subsecname}
  \framesubtitle{\secname}

  \begin{itemize}[<+->]
    \item Nix flakes
    \item nix-direnv
    \item home-manager \textcolor{fg!25}{(publicly available @ \href{https://code.europa.eu/ecphp/devs-profile}{code.europa.eu})}
    \item Servers running NixOS
  \end{itemize}

  \note<1>{
    By shipping a custom Nix flake per project, developers are able to
    customize their development environment at will. A simple example is
    this \LaTeX\ presentation which is hosted on a git repository with a flake
    file containing the required dependencies to build and contribute to it
    without worries.
  }
  \note<2>{
    I use direnv and it's brother nix-direnv to load software dependencies
    without typing any single command. This is fast, this is handy, this is
    a really unique tool that unleash it's full potential when it is used
    with Nix.
  }
  \note<3>{
    I also created a trivial home manager profile setting up a custom shell
    with some carefully chosen plugins, custom aliases and nix-direnv
    integration. Thanks to that, it reduces the amount of time a developer needs
    to spend setting up it's workstation, because this profile set everything up
    with one single command and a few seconds.
  }
  \note<4>{
    Very recently, in the OpenSource Project Office team we wanted to host
    our own instance of a note service, and we ended up setting up a bunch
    of servers. One reverse proxy, one HedgeDoc instance and some others.
    All managed by a single flake file and guess what \dots, we deploy on
    Fridays without any worries!

    While setting up our infrastructure in code, we contributed to NixOS by
    creating pull requests to fix minor issues we had.
  }
  \note<5>{
    And just like you most probably know, the road to success is never a
    straight line\dots

    The problems I have with the adoption of Nix could be summarized in one
    quote from Albert Einstein, here it is\dots
  }
\end{frame}

\begin{frame}[plain]
  \begin{quote}
    The world as we have created it is a process of our thinking.\\It cannot be
    changed without changing our thinking.
    \par\nobreak\smallskip\hfill ~---~ Albert Einstein
  \end{quote}

  \note<1>{
    <read the quote>\dots

    <make a pause>\dots

    And Mr Einstein was right, and he still is today, more than a hundred years
    later despite the efforts that are made to try to break relativity.
  }

  \note<2>{
    It's often the same pattern when something new needs to be introduced\dots

    Remember that people feared electricity when it was invented.
    There will always be ignorance, and ignorance leads to fear.

    And it's the same when it comes to Nix at European Commission.
  }

  \note<2>{
    All of this to introduce my next slide which is about the pain points
    introducing Nix at European Commission.
  }
\end{frame}

\subsection{Which problems are we facing?}

\begin{frame}
  \frametitle{\subsecname}
  \framesubtitle{\secname}

  \begin{itemize}[<+->]
    \item The fear of the unknown,
    \item The use of experimental features,
    \item The programming language,
    \item The documentation.
  \end{itemize}

  \note<1>{
    Every new piece of software fixes issues but also brings in a couple of new
    issues. Nix is quite new at E.C. and people are sometimes a bit
    reluctant to use something they never heard of\dots yet.
  }
  \note<2>{
    Flake is a feature that has been introduced in November 2021 and nowadays it
    is still considered as experimental.

    Given that, asking to such an institution to use an experimental feature in
    their day to day work might be a little bit more difficult.
  }
  \note<3>{
    Learning the Nix programming language can be tedious for developers who
    never used functional programming at all.

    But this might not be true since last week with the new tutorial that has
    been published on nix.dev (https://nix.dev/tutorials/nix-language).

    IMHO, I believe that such quality tutorial should be in the official
    documentation.
  }
  \note<4>{
    About documentation, there are still a lot of work to be done.

    This is the reason why there is a new documentation team in place in the
    community, they are in charge of "flattening the curve". That tutorial is
    their first outcome and many more are coming.
  }
\end{frame}

\subsection{What's next?}

\begin{frame}
  \frametitle{\subsecname}
  \framesubtitle{\secname}

  \begin{itemize}[<+->]
    \item Continue to experiment and evaluate Nix,
    \item Find other candidates for testing,
    \item Improve our custom development profile,
    \item Ship a \texttt{flake.nix} for each project,
    \item Contribute to the community.
  \end{itemize}

  \note<1>{
    The idea is obviously to continue experimenting with Nix, testing things and
    see how it could be adopted more broadly.

    I believe that the issues related to the fear of unknown will disapear with
    time.

    The flake feature is going to loose it's experimental flag, this is going to
    encourage more and more people to join in.

    The programming language? This is like any other language, as long as we
    have a good documentation, we can learn it correctly.
  }
  \note<2>{
    In my team, the development profile will be improved and its documentation
    as well.
  }
  \note<3>{
    I wish I could ship a flake file per project to reduce to almost zero the
    amount of time new developers need to spend setting up their environment.
    This is already the case for the open source projects in my team, but it
    would be a big plus if it could be done by default on other projects.
  }
  \note<4>{
    I told you earlier we already contributed back to NixOS with a couple of
    pull requests. The idea is to continue to work with this mindset of openness
    and sharing.
  }
\end{frame}

\thankyou

% \begin{frame}[t]{Title of frame}
%   \begin{columns}[T,onlytextwidth]
%     \begin{column}{.4\textwidth}
%       \begin{minipage}{\textwidth}
%         \begin{figure}
%           \includegraphics[width=\textwidth]{example-image}
%         \end{figure}
%         \footnotetext{Figure left top}
%       \end{minipage}
%       \begin{onlyenv}<3>
%         \begin{minipage}{\textwidth}
%           \begin{figure}
%             \includegraphics[width=\textwidth]{example-image}
%           \end{figure}
%           \footnotetext{Figure left bottom}
%         \end{minipage}
%       \end{onlyenv}
%     \end{column}
%     \begin{column}{.4\textwidth}
%       \begin{onlyenv}<2->
%         \begin{minipage}{\textwidth}
%           \begin{figure}
%             \includegraphics[width=\textwidth, height=.77\textheight]{example-image}
%           \end{figure}
%           \footnotetext{Figure right}
%         \end{minipage}
%       \end{onlyenv}
%     \end{column}
%   \end{columns}
% \end{frame}

% \begin{frame}
%   \begin{columns}
%     \column{\paperwidth}
%     \includegraphics[width=\the\paperwidth, height=.5\paperheight]{example-image}
%     \begin{tikzpicture}
%       \node[shape=rectangle, text opacity=1,minimum height=.5\paperheight, minimum width=\paperwidth, anchor=south]{
%         BODY
%       };
%     \end{tikzpicture}
%   \end{columns}
% \end{frame}

% \begin{frame}
%   \begin{columns}
%     \column{.5\paperwidth}
%     \includegraphics[width=.5\paperwidth, height=\paperheight]{example-image}
%     \column{.5\paperwidth}
%     \begin{tikzpicture}
%       \node[shape=rectangle, text opacity=1,minimum height=\paperheight, minimum width=.5\paperwidth, anchor=east]{
%         BODY
%       };
%     \end{tikzpicture}
%   \end{columns}
% \end{frame}

\end{document}
